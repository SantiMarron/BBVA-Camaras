GIRO >= 3351 & GIRO <= 3441 ~ "3351 AL 3441",
GIRO >= 3501 & GIRO <= 3899 ~ "3501 AL 3899",
TRUE ~ as.character(GIRO))) %>%
left_join(Base_CI) %>%
rename(Tasa_cred_ajena = `TASA DE DESCUENTO CRÉDITO AJENA`,
Tasa_deb_ajena = `TASA DE DESCUENTO DÉBITO AJENA`,
Tasa_cred_base = `TASA DE DESCUENTO CRÉDITO BASE`,
Tasa_deb_base = `TASA DE DESCUENTO  DÉBITO BASE`,
Ind_cuota = `CUOTA DEBITO`,
Cuota_deb2 = `CUOTA DÉBITO`) %>%
mutate_at(c("Tasa_cred_base", "Tasa_cred_ajena", "CI_cred",
"Tasa_deb_base", "Tasa_deb_ajena", "Cuota_deb2",
"CI_deb", "Cuota_deb_CI"), as.numeric) %>%
mutate(
Comp_CI_cred =
case_when(is.na(Tasa_cred_base) & Tasa_cred_ajena > CI_cred ~ "TD mayor a CI",
!is.na(Tasa_cred_base) & Tasa_cred_base > CI_cred ~ "TD mayor a CI",
is.na(Tasa_cred_base) & Tasa_cred_ajena == CI_cred ~ "TD igual a CI",
!is.na(Tasa_cred_base) & Tasa_cred_base == CI_cred ~ "TD igual a CI",
is.na(Tasa_cred_base) & Tasa_cred_ajena < CI_cred ~ "TD menor a CI",
!is.na(Tasa_cred_base) & Tasa_cred_base < CI_cred ~ "TD menor a CI",
is.na(CI_cred)  ~ "No se tiene la CI")) %>%
mutate(
Comp_CI_deb =
case_when(Ind_cuota == "T" & is.na(Tasa_deb_base) & Tasa_deb_ajena > CI_deb ~ "TD mayor a CI",
Ind_cuota == "T" & !is.na(Tasa_deb_base) & Tasa_deb_base > CI_deb ~ "TD mayor a CI",
Ind_cuota == "T" & is.na(Tasa_deb_base) & Tasa_deb_ajena == CI_deb ~ "TD igual a CI",
Ind_cuota == "T" & !is.na(Tasa_deb_base) & Tasa_deb_base == CI_deb ~ "TD igual a CI",
Ind_cuota == "T" & is.na(Tasa_deb_base) & Tasa_deb_ajena < CI_deb ~ "TD menor a CI",
Ind_cuota == "T" & !is.na(Tasa_deb_base) & Tasa_deb_base < CI_deb ~ "TD menor a CI",
is.na(CI_deb) ~ "No se tiene la CI")) %>%
mutate(
Comp_CI_deb2 =
case_when(Ind_cuota == "C" & !is.nan(Cuota_deb_CI) & Cuota_deb2 > Cuota_deb_CI ~ "TD mayor a CI",
Ind_cuota == "C" & !is.nan(Cuota_deb_CI) & Cuota_deb2 == Cuota_deb_CI ~ "TD igual a CI",
Ind_cuota == "C"&  !is.nan(Cuota_deb_CI) & Cuota_deb2 < Cuota_deb_CI ~ "TD menor a CI",
Ind_cuota == "C" & is.nan(Cuota_deb_CI) ~ "No aplica",
TRUE ~ as.character (Comp_CI_deb))) %>%
select(-estatus, -Tasa_cred, -Tasa_deb, - Cuota_deb, -revtasa_cred, -revtasa_deb, -revcuota_deb,
-MCC, -Comp_CI_deb, -`CUOTA DE APERTURA`, -`COMISION USO GPRS`, -`COMISION BAJA FACTURACION`,
-CRÉDITO, -Débito)
write.csv(Comparacion_CI, "Outputs/Comparacion de TD y CI en base nueva.csv",
row.names = F)
a <- Comparacion_CI %>%
group_by(Comp_CI_cred) %>%
summarise(Num_de_afiliaciones_cred = n()) %>%
rename(Estatus = Comp_CI_cred)
b <- Comparacion_CI %>%
group_by(Comp_CI_deb2) %>%
summarise(Num_de_afiliaciones_deb = n()) %>%
rename(Estatus = Comp_CI_deb2)
T_resum_CI <- a %>%
full_join(b) %>%
mutate(Porc_cred = Num_de_afiliaciones_cred / sum(Num_de_afiliaciones_cred, na.rm = T),
Porc_deb = Num_de_afiliaciones_deb / sum(Num_de_afiliaciones_deb)) %>%
arrange(desc(Porc_deb))
rm(a, b)
write.csv(T_resum_CI, "Outputs/Tabla resumen comparacion TD y CI.csv",
row.names = F)
View(T_resum_CI)
# BBVA Competencia Camaras (ult. act 1 junio 2020)
# Revision de negocios con tasas de descuento menores a cuotas de intercambio
gc()
library(tidyverse)
library(readxl)
library(xlsx)
##### Lectura de bases de datos #####
source <- function(f, encoding = 'UTF-8') { # Para que el source si lea acentos y caracteres raros
l <- readLines(f, encoding=encoding)
eval(parse(text=l),envir=.GlobalEnv)
}
source("Codigos/Comparacion tasas descuento y cuotas intercambio.R")
rm(list=setdiff(ls(), "Comparacion_CI"))
Entregada <- read_excel("Inputs/124_vi_2019_10.xlsx") %>%
rename(AFILIACION = AFILIACION_NUM,
Tasa_cred = `TASA CRED`,
Tasa_deb = `TASA DEB`,
Cuota_deb = `CUOT DEB`) %>%
mutate_at(c("Tasa_cred", "Tasa_deb", "Cuota_deb", "FACT_TDC", "FACT_DEB"), as.numeric) %>%
select(AFILIACION, FACT_TDC, FACT_DEB)
##### Filtro de TD menor a CI e indicador de igualdad entre ajena y propia #####
Casos <- Comparacion_CI %>%
filter(Comp_CI_cred == "TD menor a CI" | Comp_CI_deb2 == "TD menor a CI") %>%
select(-GRUPO, -CADENA) %>%
rename(Tasa_cred_propia =`TASA DE DESCUENTO CRÉDITO PROPIA`,
Tasa_deb_propia =`TASA DE DESCUENTO DÉBITO PROPIA`) %>%
mutate_at(c("Tasa_cred_base", "Tasa_deb_base", "Tasa_cred_propia",
"Tasa_cred_ajena", "Tasa_deb_propia", "Tasa_deb_ajena",
"Cuota_deb2"), as.numeric) %>%
mutate(Ind_cred =
case_when(
(Tasa_cred_propia - Tasa_cred_ajena == 0) & is.na(Tasa_cred_base) ~ "Iguales",
Tasa_cred_propia == 0  & Tasa_cred_ajena == 0 & !is.na(Tasa_cred_base) ~ "Base",
(Tasa_cred_propia - Tasa_cred_ajena != 0) & is.na(Tasa_cred_base) ~ "Distintas"),
Ind_deb =
case_when(
Ind_cuota == "C" ~ "Cuota",
(Tasa_deb_propia - Tasa_deb_ajena == 0) & is.na(Tasa_deb_base) ~ "Iguales",
Tasa_deb_propia == 0  & Tasa_deb_ajena == 0 & !is.na(Tasa_deb_base) ~ "Base",
(Tasa_deb_propia - Tasa_deb_ajena != 0) & is.na(Tasa_deb_base) ~ "Distintas"))
##### Bases de casos para credito y para debito y listas de negocios en Excel #####
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred)
a <- Casos_cred %>% distinct(`RAZON SOCIAL`) %>% arrange(`RAZON SOCIAL`)
b <- Casos_deb %>% distinct(`RAZON SOCIAL`) %>% arrange(`RAZON SOCIAL`)
write.xlsx2(as.data.frame(a), "Outputs/Negocios con potencial riesgo TD menor a CI.xlsx",
sheetName = "Credito", row.names = F, append = F)
write.xlsx2(as.data.frame(b), "Outputs/Negocios con potencial riesgo TD menor a CI.xlsx",
sheetName = "Debito", row.names = F, append = T)
rm(a,b)
##### Union con base entregada para ver % de facturacion, credito y debito #####
Fact_cred <- Casos_cred %>%
left_join(Entregada) %>%
filter(!is.na(FACT_TDC)) %>% select(-Ind_cred)
print(nrow(Fact_cred)/nrow(Casos_cred)) # % que hace match con original para facturacion
print(sum(Fact_cred$FACT_TDC)/sum(Entregada$FACT_TDC)) # % de la facturacion de los que TD < CI
Fact_deb <- Casos_deb %>%
left_join(Entregada) %>%
filter(!is.na(FACT_TDC)) %>% select(-Ind_deb)
print(nrow(Fact_deb)/nrow(Casos_deb)) # % que hace match con original para facturacion
print(sum(Fact_deb$FACT_DEB)/sum(Entregada$FACT_DEB)) # % de la facturacion de los que TD < CI
##### Anexo: Filtro de tasas que podrian ser ponderables entre ajena y propia #####
# Alejandra Magaña indico en Teams el 1 de junio que BBVA tiene participacion de emisor de 28%, esa seria para la tasa propia
Cred_ponderados <- Casos_cred %>%
filter(Ind_cred == "Distintas") # Todas son iguales o la base
Deb_ponderados <- Casos_deb %>%
filter(Ind_deb == "Distintas" ) %>%
mutate(Tasa_deb_pond = 0.28*Tasa_deb_propia + 0.72*Tasa_deb_ajena) #Sigue siendo menor, de hecho aun menor
rm(Cred_ponderados)
rm(Deb_ponderados)
View(Comparacion_CI)
Llave_gpo_cad_giro <- Comparacion_CI %>%
select(AFILIACION, GRUPO, CADENA, `RAZON SOCIAL`, GIRO)
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
left_join(Llave_gpo_cad_giro) %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb)
View(Casos_cred)
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
left_join(Llave_gpo_cad_giro) %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb) %>%
select(1, 2, 12, 13, 3:11)
View(Casos_cred)
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
left_join(Llave_gpo_cad_giro) %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb) %>%
select(1, 2, 12, 13, 3:11)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
left_join(Llave_gpo_cad_giro) %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred) %>%
select(1, 2, 12, 13, 3:11)
View(Casos_deb)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
left_join(Llave_gpo_cad_giro) %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred)
View(Casos_deb)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
left_join(Llave_gpo_cad_giro) %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred) %>%
select(1, 2, 14, 15, 3:13)
View(Casos_deb)
a <- Casos_cred %>% distinct(`RAZON SOCIAL`, GRUPO) %>% arrange(`RAZON SOCIAL`)
View(a)
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred)
a <- Casos_cred %>% distinct(`RAZON SOCIAL`, GIRO) %>% arrange(`RAZON SOCIAL`)
b <- Casos_deb %>% distinct(`RAZON SOCIAL`, GIRO) %>% arrange(`RAZON SOCIAL`)
View(a)
View(b)
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred)
a <- Casos_cred %>% distinct(`RAZON SOCIAL`) %>% arrange(`RAZON SOCIAL`)
b <- Casos_deb %>% distinct(`RAZON SOCIAL`) %>% arrange(`RAZON SOCIAL`)
# BBVA Competencia Camaras (ult. act 1 junio 2020)
# Revision de negocios con tasas de descuento menores a cuotas de intercambio
gc()
library(tidyverse)
library(readxl)
library(xlsx)
##### Lectura de bases de datos #####
source <- function(f, encoding = 'UTF-8') { # Para que el source si lea acentos y caracteres raros
l <- readLines(f, encoding=encoding)
eval(parse(text=l),envir=.GlobalEnv)
}
source("Codigos/Comparacion tasas descuento y cuotas intercambio.R")
rm(list=setdiff(ls(), "Comparacion_CI"))
Entregada <- read_excel("Inputs/124_vi_2019_10.xlsx") %>%
rename(AFILIACION = AFILIACION_NUM,
Tasa_cred = `TASA CRED`,
Tasa_deb = `TASA DEB`,
Cuota_deb = `CUOT DEB`) %>%
mutate_at(c("Tasa_cred", "Tasa_deb", "Cuota_deb", "FACT_TDC", "FACT_DEB"), as.numeric) %>%
select(AFILIACION, FACT_TDC, FACT_DEB)
##### Filtro de TD menor a CI e indicador de igualdad entre ajena y propia #####
Casos <- Comparacion_CI %>%
filter(Comp_CI_cred == "TD menor a CI" | Comp_CI_deb2 == "TD menor a CI") %>%
select(-GRUPO, -CADENA) %>%
rename(Tasa_cred_propia =`TASA DE DESCUENTO CRÉDITO PROPIA`,
Tasa_deb_propia =`TASA DE DESCUENTO DÉBITO PROPIA`) %>%
mutate_at(c("Tasa_cred_base", "Tasa_deb_base", "Tasa_cred_propia",
"Tasa_cred_ajena", "Tasa_deb_propia", "Tasa_deb_ajena",
"Cuota_deb2"), as.numeric) %>%
mutate(Ind_cred =
case_when(
(Tasa_cred_propia - Tasa_cred_ajena == 0) & is.na(Tasa_cred_base) ~ "Iguales",
Tasa_cred_propia == 0  & Tasa_cred_ajena == 0 & !is.na(Tasa_cred_base) ~ "Base",
(Tasa_cred_propia - Tasa_cred_ajena != 0) & is.na(Tasa_cred_base) ~ "Distintas"),
Ind_deb =
case_when(
Ind_cuota == "C" ~ "Cuota",
(Tasa_deb_propia - Tasa_deb_ajena == 0) & is.na(Tasa_deb_base) ~ "Iguales",
Tasa_deb_propia == 0  & Tasa_deb_ajena == 0 & !is.na(Tasa_deb_base) ~ "Base",
(Tasa_deb_propia - Tasa_deb_ajena != 0) & is.na(Tasa_deb_base) ~ "Distintas"))
##### Bases de casos para credito y para debito y listas de negocios en Excel #####
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred)
a <- Casos_cred %>% distinct(`RAZON SOCIAL`) %>% arrange(`RAZON SOCIAL`)
b <- Casos_deb %>% distinct(`RAZON SOCIAL`) %>% arrange(`RAZON SOCIAL`)
write.xlsx2(as.data.frame(a), "Outputs/Negocios con potencial riesgo TD menor a CI.xlsx",
sheetName = "Credito", row.names = F, append = F)
write.xlsx2(as.data.frame(b), "Outputs/Negocios con potencial riesgo TD menor a CI.xlsx",
sheetName = "Debito", row.names = F, append = T)
rm(a,b)
##### Union con base entregada para ver % de facturacion, credito y debito #####
Fact_cred <- Casos_cred %>%
left_join(Entregada) %>%
filter(!is.na(FACT_TDC)) %>% select(-Ind_cred)
print(nrow(Fact_cred)/nrow(Casos_cred)) # % que hace match con original para facturacion
print(sum(Fact_cred$FACT_TDC)/sum(Entregada$FACT_TDC)) # % de la facturacion de los que TD < CI
Fact_deb <- Casos_deb %>%
left_join(Entregada) %>%
filter(!is.na(FACT_TDC)) %>% select(-Ind_deb)
print(nrow(Fact_deb)/nrow(Casos_deb)) # % que hace match con original para facturacion
print(sum(Fact_deb$FACT_DEB)/sum(Entregada$FACT_DEB)) # % de la facturacion de los que TD < CI
##### Anexo: Filtro de tasas que podrian ser ponderables entre ajena y propia #####
# Alejandra Magaña indico en Teams el 1 de junio que BBVA tiene participacion de emisor de 28%, esa seria para la tasa propia
Cred_ponderados <- Casos_cred %>%
filter(Ind_cred == "Distintas") # Todas son iguales o la base
Deb_ponderados <- Casos_deb %>%
filter(Ind_deb == "Distintas" ) %>%
mutate(Tasa_deb_pond = 0.28*Tasa_deb_propia + 0.72*Tasa_deb_ajena) #Sigue siendo menor, de hecho aun menor
rm(Cred_ponderados)
rm(Deb_ponderados)
# BBVA Competencia Camaras (ult. act 1 junio 2020)
# Revision de negocios con tasas de descuento menores a cuotas de intercambio
gc()
library(tidyverse)
library(readxl)
library(xlsx)
##### Lectura de bases de datos #####
source <- function(f, encoding = 'UTF-8') { # Para que el source si lea acentos y caracteres raros
l <- readLines(f, encoding=encoding)
eval(parse(text=l),envir=.GlobalEnv)
}
source("Codigos/Comparacion tasas descuento y cuotas intercambio.R")
rm(list=setdiff(ls(), "Comparacion_CI"))
Entregada <- read_excel("Inputs/124_vi_2019_10.xlsx") %>%
rename(AFILIACION = AFILIACION_NUM,
Tasa_cred = `TASA CRED`,
Tasa_deb = `TASA DEB`,
Cuota_deb = `CUOT DEB`) %>%
mutate_at(c("Tasa_cred", "Tasa_deb", "Cuota_deb", "FACT_TDC", "FACT_DEB"), as.numeric) %>%
select(AFILIACION, FACT_TDC, FACT_DEB)
##### Filtro de TD menor a CI e indicador de igualdad entre ajena y propia #####
Casos <- Comparacion_CI %>%
filter(Comp_CI_cred == "TD menor a CI" | Comp_CI_deb2 == "TD menor a CI") %>%
select(-GRUPO, -CADENA) %>%
rename(Tasa_cred_propia =`TASA DE DESCUENTO CRÉDITO PROPIA`,
Tasa_deb_propia =`TASA DE DESCUENTO DÉBITO PROPIA`) %>%
mutate_at(c("Tasa_cred_base", "Tasa_deb_base", "Tasa_cred_propia",
"Tasa_cred_ajena", "Tasa_deb_propia", "Tasa_deb_ajena",
"Cuota_deb2"), as.numeric) %>%
mutate(Ind_cred =
case_when(
(Tasa_cred_propia - Tasa_cred_ajena == 0) & is.na(Tasa_cred_base) ~ "Iguales",
Tasa_cred_propia == 0  & Tasa_cred_ajena == 0 & !is.na(Tasa_cred_base) ~ "Base",
(Tasa_cred_propia - Tasa_cred_ajena != 0) & is.na(Tasa_cred_base) ~ "Distintas"),
Ind_deb =
case_when(
Ind_cuota == "C" ~ "Cuota",
(Tasa_deb_propia - Tasa_deb_ajena == 0) & is.na(Tasa_deb_base) ~ "Iguales",
Tasa_deb_propia == 0  & Tasa_deb_ajena == 0 & !is.na(Tasa_deb_base) ~ "Base",
(Tasa_deb_propia - Tasa_deb_ajena != 0) & is.na(Tasa_deb_base) ~ "Distintas"))
##### Bases de casos para credito y para debito y listas de negocios en Excel #####
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred)
a <- Casos_cred %>% distinct(`RAZON SOCIAL`) %>% arrange(`RAZON SOCIAL`)
b <- Casos_deb %>% distinct(`RAZON SOCIAL`) %>% arrange(`RAZON SOCIAL`)
write.xlsx2(as.data.frame(a), "Outputs/Negocios con potencial riesgo TD menor a CI.xlsx",
sheetName = "Credito", row.names = F, append = F)
write.xlsx2(as.data.frame(b), "Outputs/Negocios con potencial riesgo TD menor a CI.xlsx",
sheetName = "Debito", row.names = F, append = T)
rm(a,b)
##### Union con base entregada para ver % de facturacion, credito y debito #####
Fact_cred <- Casos_cred %>%
left_join(Entregada) %>%
filter(!is.na(FACT_TDC)) %>% select(-Ind_cred)
print(nrow(Fact_cred)/nrow(Casos_cred)) # % que hace match con original para facturacion
print(sum(Fact_cred$FACT_TDC)/sum(Entregada$FACT_TDC)) # % de la facturacion de los que TD < CI
Fact_deb <- Casos_deb %>%
left_join(Entregada) %>%
filter(!is.na(FACT_TDC)) %>% select(-Ind_deb)
print(nrow(Fact_deb)/nrow(Casos_deb)) # % que hace match con original para facturacion
print(sum(Fact_deb$FACT_DEB)/sum(Entregada$FACT_DEB)) # % de la facturacion de los que TD < CI
##### Anexo: Filtro de tasas que podrian ser ponderables entre ajena y propia #####
# Alejandra Magaña indico en Teams el 1 de junio que BBVA tiene participacion de emisor de 28%, esa seria para la tasa propia
Cred_ponderados <- Casos_cred %>%
filter(Ind_cred == "Distintas") # Todas son iguales o la base
Deb_ponderados <- Casos_deb %>%
filter(Ind_deb == "Distintas" ) %>%
mutate(Tasa_deb_pond = 0.28*Tasa_deb_propia + 0.72*Tasa_deb_ajena) #Sigue siendo menor, de hecho aun menor
rm(Cred_ponderados)
rm(Deb_ponderados)
# BBVA Competencia Camaras (ult. act 1 junio 2020)
# Revision de negocios con tasas de descuento menores a cuotas de intercambio
gc()
library(tidyverse)
library(readxl)
library(xlsx)
##### Lectura de bases de datos #####
source <- function(f, encoding = 'UTF-8') { # Para que el source si lea acentos y caracteres raros
l <- readLines(f, encoding=encoding)
eval(parse(text=l),envir=.GlobalEnv)
}
source("Codigos/Comparacion tasas descuento y cuotas intercambio.R")
rm(list=setdiff(ls(), "Comparacion_CI"))
Entregada <- read_excel("Inputs/124_vi_2019_10.xlsx") %>%
rename(AFILIACION = AFILIACION_NUM,
Tasa_cred = `TASA CRED`,
Tasa_deb = `TASA DEB`,
Cuota_deb = `CUOT DEB`) %>%
mutate_at(c("Tasa_cred", "Tasa_deb", "Cuota_deb", "FACT_TDC", "FACT_DEB"), as.numeric) %>%
select(AFILIACION, FACT_TDC, FACT_DEB)
##### Filtro de TD menor a CI e indicador de igualdad entre ajena y propia #####
Casos <- Comparacion_CI %>%
filter(Comp_CI_cred == "TD menor a CI" | Comp_CI_deb2 == "TD menor a CI") %>%
select(-GRUPO, -CADENA) %>%
rename(Tasa_cred_propia =`TASA DE DESCUENTO CRÉDITO PROPIA`,
Tasa_deb_propia =`TASA DE DESCUENTO DÉBITO PROPIA`) %>%
mutate_at(c("Tasa_cred_base", "Tasa_deb_base", "Tasa_cred_propia",
"Tasa_cred_ajena", "Tasa_deb_propia", "Tasa_deb_ajena",
"Cuota_deb2"), as.numeric) %>%
mutate(Ind_cred =
case_when(
(Tasa_cred_propia - Tasa_cred_ajena == 0) & is.na(Tasa_cred_base) ~ "Iguales",
Tasa_cred_propia == 0  & Tasa_cred_ajena == 0 & !is.na(Tasa_cred_base) ~ "Base",
(Tasa_cred_propia - Tasa_cred_ajena != 0) & is.na(Tasa_cred_base) ~ "Distintas"),
Ind_deb =
case_when(
Ind_cuota == "C" ~ "Cuota",
(Tasa_deb_propia - Tasa_deb_ajena == 0) & is.na(Tasa_deb_base) ~ "Iguales",
Tasa_deb_propia == 0  & Tasa_deb_ajena == 0 & !is.na(Tasa_deb_base) ~ "Base",
(Tasa_deb_propia - Tasa_deb_ajena != 0) & is.na(Tasa_deb_base) ~ "Distintas"))
View(Comparacion_CI)
Llave_gpo_cad <- Comparacion_CI %>%
select(AFILIACION, GRUPO, CADENA, `RAZON SOCIAL`, GIRO)
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb) %>%
left_join(Llave_gpo_cad)
View(Casos_cred)
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb) %>%
left_join(Llave_gpo_cad)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred) %>%
left_join(Llave_gpo_cad)
Llave_gpo_cad <- Comparacion_CI %>%
select(AFILIACION, GRUPO, CADENA, `RAZON SOCIAL`, GIRO)
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb) %>%
left_join(Llave_gpo_cad)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred) %>%
left_join(Llave_gpo_cad)
a <- Casos_cred %>% distinct(AFILIACION, GRUPO, CADENA, `RAZON SOCIAL`, GIRO)
b <- Casos_deb %>% distinct(AFILIACION, GRUPO, CADENA, `RAZON SOCIAL`, GIRO)
write.xlsx2(as.data.frame(a), "Outputs/Negocios con potencial riesgo TD menor a CI.xlsx",
sheetName = "Credito", row.names = F, append = F)
write.xlsx2(as.data.frame(b), "Outputs/Negocios con potencial riesgo TD menor a CI.xlsx",
sheetName = "Debito", row.names = F, append = T)
rm(a,b)
# BBVA Competencia Camaras (ult. act 1 junio 2020)
# Revision de negocios con tasas de descuento menores a cuotas de intercambio
gc()
library(tidyverse)
library(readxl)
library(xlsx)
##### Lectura de bases de datos #####
source <- function(f, encoding = 'UTF-8') { # Para que el source si lea acentos y caracteres raros
l <- readLines(f, encoding=encoding)
eval(parse(text=l),envir=.GlobalEnv)
}
source("Codigos/Comparacion tasas descuento y cuotas intercambio.R")
rm(list=setdiff(ls(), "Comparacion_CI"))
Entregada <- read_excel("Inputs/124_vi_2019_10.xlsx") %>%
rename(AFILIACION = AFILIACION_NUM,
Tasa_cred = `TASA CRED`,
Tasa_deb = `TASA DEB`,
Cuota_deb = `CUOT DEB`) %>%
mutate_at(c("Tasa_cred", "Tasa_deb", "Cuota_deb", "FACT_TDC", "FACT_DEB"), as.numeric) %>%
select(AFILIACION, FACT_TDC, FACT_DEB)
##### Filtro de TD menor a CI e indicador de igualdad entre ajena y propia #####
Casos <- Comparacion_CI %>%
filter(Comp_CI_cred == "TD menor a CI" | Comp_CI_deb2 == "TD menor a CI") %>%
select(-GRUPO, -CADENA) %>%
rename(Tasa_cred_propia =`TASA DE DESCUENTO CRÉDITO PROPIA`,
Tasa_deb_propia =`TASA DE DESCUENTO DÉBITO PROPIA`) %>%
mutate_at(c("Tasa_cred_base", "Tasa_deb_base", "Tasa_cred_propia",
"Tasa_cred_ajena", "Tasa_deb_propia", "Tasa_deb_ajena",
"Cuota_deb2"), as.numeric) %>%
mutate(Ind_cred =
case_when(
(Tasa_cred_propia - Tasa_cred_ajena == 0) & is.na(Tasa_cred_base) ~ "Iguales",
Tasa_cred_propia == 0  & Tasa_cred_ajena == 0 & !is.na(Tasa_cred_base) ~ "Base",
(Tasa_cred_propia - Tasa_cred_ajena != 0) & is.na(Tasa_cred_base) ~ "Distintas"),
Ind_deb =
case_when(
Ind_cuota == "C" ~ "Cuota",
(Tasa_deb_propia - Tasa_deb_ajena == 0) & is.na(Tasa_deb_base) ~ "Iguales",
Tasa_deb_propia == 0  & Tasa_deb_ajena == 0 & !is.na(Tasa_deb_base) ~ "Base",
(Tasa_deb_propia - Tasa_deb_ajena != 0) & is.na(Tasa_deb_base) ~ "Distintas"))
##### Bases de casos para credito y para debito y listas de negocios en Excel #####
Llave_gpo_cad <- Comparacion_CI %>%
select(AFILIACION, GRUPO, CADENA, `RAZON SOCIAL`, GIRO)
Casos_cred <- Casos %>%
filter(Comp_CI_cred == "TD menor a CI") %>%
select(-Tasa_deb_base, -Tasa_deb_propia, -Tasa_deb_ajena, -Cuota_deb2, -Cuota_deb_CI,
-Comp_CI_deb2, -Ind_cuota, -Ind_deb) %>%
left_join(Llave_gpo_cad)
Casos_deb <- Casos %>%
filter(Comp_CI_deb2 == "TD menor a CI") %>%
select(-Tasa_cred_base, -Tasa_cred_propia, -Tasa_cred_ajena, -CI_cred,
-Comp_CI_cred, -Ind_cred) %>%
left_join(Llave_gpo_cad)
a <- Casos_cred %>% distinct(AFILIACION, GRUPO, CADENA, `RAZON SOCIAL`, GIRO)
b <- Casos_deb %>% distinct(AFILIACION, GRUPO, CADENA, `RAZON SOCIAL`, GIRO)
write.xlsx2(as.data.frame(a), "Outputs/Negocios con potencial riesgo TD menor a CI.xlsx",
sheetName = "Credito", row.names = F, append = F)
write.xlsx2(as.data.frame(b), "Outputs/Negocios con potencial riesgo TD menor a CI.xlsx",
sheetName = "Debito", row.names = F, append = T)
rm(a,b)
##### Union con base entregada para ver % de facturacion, credito y debito #####
Fact_cred <- Casos_cred %>%
left_join(Entregada) %>%
filter(!is.na(FACT_TDC)) %>% select(-Ind_cred)
print(nrow(Fact_cred)/nrow(Casos_cred)) # % que hace match con original para facturacion
print(sum(Fact_cred$FACT_TDC)/sum(Entregada$FACT_TDC)) # % de la facturacion de los que TD < CI
Fact_deb <- Casos_deb %>%
left_join(Entregada) %>%
filter(!is.na(FACT_TDC)) %>% select(-Ind_deb)
print(nrow(Fact_deb)/nrow(Casos_deb)) # % que hace match con original para facturacion
print(sum(Fact_deb$FACT_DEB)/sum(Entregada$FACT_DEB)) # % de la facturacion de los que TD < CI
##### Anexo: Filtro de tasas que podrian ser ponderables entre ajena y propia #####
# Alejandra Magaña indico en Teams el 1 de junio que BBVA tiene participacion de emisor de 28%, esa seria para la tasa propia
Cred_ponderados <- Casos_cred %>%
filter(Ind_cred == "Distintas") # Todas son iguales o la base
Deb_ponderados <- Casos_deb %>%
filter(Ind_deb == "Distintas" ) %>%
mutate(Tasa_deb_pond = 0.28*Tasa_deb_propia + 0.72*Tasa_deb_ajena) #Sigue siendo menor, de hecho aun menor
rm(Cred_ponderados)
rm(Deb_ponderados)
